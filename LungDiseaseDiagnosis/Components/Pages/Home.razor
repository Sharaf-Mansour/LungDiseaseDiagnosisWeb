@page "/"
@using Microsoft.AspNetCore.Components.Authorization
@using LungDiseaseDiagnosis.Models
@using LungDiseaseDiagnosis.Services
@inject IUserService UserService
@inject NavigationManager NavigationManager

<PageTitle>Home</PageTitle>

@if (UserService.CurrentUser is not null)
{
    @if (UserService.CurrentUser.Type == MedType.Doctor)
    {
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <h1 class="display-5 fw-bold">Doctor Dashboard</h1>
                    <p class="lead text-muted mb-5">Welcome, @UserService.CurrentUser.Name</p>
                    <div class="d-grid gap-3 d-md-flex justify-content-md-center">
                        <button class="btn btn-primary btn-lg" @onclick='() => NavigationManager.NavigateTo("/review-report")'>
                            <i class="bi bi-clipboard2-pulse"></i> Review Report
                        </button>
                        <button class="btn btn-info btn-lg"
                            @onclick='() => NavigationManager.NavigateTo("/medical-image-analysis")'>
                            <i class="bi bi-cloud-upload"></i> Upload Image
                        </button>
                        <button class="btn btn-secondary btn-lg" @onclick='() => NavigationManager.NavigateTo("/results")'>
                            <i class="bi bi-card-list"></i> View All Results
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
    else if (UserService.CurrentUser.Type == MedType.Nurse)
    {
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <h1 class="display-5 fw-bold">Nurse Dashboard</h1>
                    <p class="lead text-muted mb-5">Welcome, @UserService.CurrentUser.Name</p>
                    <div class="d-grid gap-3 d-md-flex justify-content-md-center">
                        <button class="btn btn-primary btn-lg" @onclick='() => NavigationManager.NavigateTo("/general-notes")'>
                            <i class="bi bi-pencil-square"></i> Write General Notes
                        </button>
                        <button class="btn btn-info btn-lg"
                            @onclick='() => NavigationManager.NavigateTo("/medical-image-analysis")'>
                            <i class="bi bi-cloud-upload"></i> Upload Image
                        </button>
                        <button class="btn btn-secondary btn-lg"
                            @onclick='() => NavigationManager.NavigateTo("/track-report-state")'>
                            <i class="bi bi-graph-up"></i> Track Report State
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <h1 class="display-5 fw-bold">Welcome, @UserService.CurrentUser.Name</h1>
                    <p class="lead text-muted mb-5">You are logged in as a @UserService.CurrentUser.Type.</p>
                </div>
            </div>
        </div>
    }
}
else
{
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <h1 class="hero-title">
                        <i class="bi bi-heart-pulse"></i> MedAI Diagnostics
                    </h1>
                    <p class="hero-subtitle">
                        Advanced AI-powered medical image analysis for respiratory conditions.
                        Get instant, accurate diagnostic assistance for chest X-rays and medical imaging.
                    </p>
                    <div class="mt-4">

                        <a href="login" class="btn btn-outline-medical btn-lg">
                            <i class="bi bi-box-arrow-in-right"></i> Medical Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Medical Conditions Section -->
    <section class="py-5" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
        <div class="container">
            <div class="row text-center text-white mb-5">
                <div class="col-12">
                    <h2 class="display-5 fw-bold mb-3">Diagnostic Capabilities</h2>
                    <p class="lead">Our AI can detect and analyze the following respiratory conditions</p>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card-premium p-4 h-100">
                        <div class="text-center">
                            <i class="bi bi-lungs text-primary fs-1 mb-3"></i>
                            <h5 class="fw-bold">Bacterial Pneumonia</h5>
                            <p class="text-muted">Bacterial infection causing inflammation in lung air sacs</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card-premium p-4 h-100">
                        <div class="text-center">
                            <i class="bi bi-virus text-danger fs-1 mb-3"></i>
                            <h5 class="fw-bold">COVID-19</h5>
                            <p class="text-muted">Corona Virus Disease respiratory complications</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card-premium p-4 h-100">
                        <div class="text-center">
                            <i class="bi bi-heart-pulse text-success fs-1 mb-3"></i>
                            <h5 class="fw-bold">Normal</h5>
                            <p class="text-muted">Healthy lung condition with no abnormalities detected</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-5">
        <div class="container">
            <div class="row text-center text-white mb-5">
                <div class="col-12">
                    <h2 class="display-5 fw-bold mb-3">Why Choose MedAI?</h2>
                    <p class="lead">Advanced medical AI technology for healthcare professionals</p>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-4">
                    <div class="text-center text-white">
                        <div class="feature-icon">
                            <i class="bi bi-lightning-charge"></i>
                        </div>
                        <h4 class="fw-bold">Instant Analysis</h4>
                        <p>Get diagnostic results in seconds with our optimized neural networks</p>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="text-center text-white">
                        <div class="feature-icon">
                            <i class="bi bi-award"></i>
                        </div>
                        <h4 class="fw-bold">Medical Grade</h4>
                        <p>Trained on extensive medical datasets with high diagnostic accuracy</p>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="text-center text-white">
                        <div class="feature-icon">
                            <i class="bi bi-shield-check"></i>
                        </div>
                        <h4 class="fw-bold">HIPAA Compliant</h4>
                        <p>Secure processing with patient privacy and data protection</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-5" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card-premium p-5 text-center">
                        <h3 class="fw-bold mb-3">Ready to Enhance Your Diagnostic Workflow?</h3>
                        <p class="text-muted mb-4">
                            Join healthcare professionals worldwide who trust MedAI for accurate,
                            fast medical image analysis. Start your diagnostic journey today.
                        </p>
                        <a href="signup" class="btn btn-medical btn-lg">
                            <i class="bi bi-person-plus"></i> Create Medical Account
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // A small delay to allow NavMenu to potentially load the user from storage first.
            await Task.Delay(1);
            // If the user is loaded, trigger a re-render to show the correct dashboard.
            StateHasChanged();
        }
    }
}
